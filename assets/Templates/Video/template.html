<div id="video" class="graphic video-graphic" data-fullscreen="{{fullscreen}}">
    <div class="video-container">
        <video id="{{elementId}}"
               controls
               data-loop="{{loop}}"
               data-muted="{{muted}}"
               data-autoplay="{{autoplay}}">
            <source src="{{source}}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
    <style>
        .video-graphic {
            position: absolute;
            top: {{top}}px;
            left: {{left}}px;
            z-index: 50;
        }
        .video-graphic.fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
        }
        .video-container {
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .video-graphic.fullscreen .video-container {
            border-radius: 0;
            width: 100%;
            height: 100%;
        }
        #{{elementId}} {
            display: block;
            width: {{width}}px;
            height: {{height}}px;
            object-fit: contain;
            background: #000;
        }
        .video-graphic.fullscreen #{{elementId}} {
            width: 100vw !important;
            height: 100vh !important;
            object-fit: contain;
        }
    </style>
    <script>
        (function() {
            var wrapper = document.querySelector('#video');
            var video = document.getElementById('{{elementId}}');
            
            // Apply fullscreen class if enabled
            if (wrapper.dataset.fullscreen === '1') {
                wrapper.classList.add('fullscreen');
            }
            
            // Apply video attributes
            if (video.dataset.loop === '1') {
                video.loop = true;
            }
            if (video.dataset.muted === '1') {
                video.muted = true;
            }
            
            // Debug logging
            video.addEventListener('error', function(e) {
                console.error('Video Error:', video.error);
                console.error('Video Source:', video.currentSrc);
                console.error('Network State:', video.networkState);
                console.error('Ready State:', video.readyState);
            });
            
            video.addEventListener('loadstart', function() { console.log('Video loadstart'); });
            video.addEventListener('loadedmetadata', function() { console.log('Video loadedmetadata'); });
            video.addEventListener('loadeddata', function() { console.log('Video loadeddata'); });
            video.addEventListener('playing', function() { console.log('Video playing'); });
            video.addEventListener('pause', function() { console.log('Video pause'); });

            if (video.dataset.autoplay === '1') {
                video.autoplay = true;
                video.play().catch(function(e) {
                    console.error('Autoplay prevented:', e);
                });
            }
            
            // Expose global function to toggle fullscreen
            window.toggleVideoFullscreen = function() {
                wrapper.classList.toggle('fullscreen');
                return wrapper.classList.contains('fullscreen');
            };
            
            // Expose video controls
            window.videoPlay = function() { video.play(); };
            window.videoPause = function() { video.pause(); };
            window.videoStop = function() { video.pause(); video.currentTime = 0; };
            window.videoSeek = function(seconds) { video.currentTime = seconds; };
        })();
    </script>
</div>
